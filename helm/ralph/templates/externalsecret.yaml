{{- if .Values.externalSecrets.enabled }}
---
# GitHub Token
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: {{ include "ralph.fullname" . }}-github-token
  labels:
    {{- include "ralph.labels" . | nindent 4 }}
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: {{ include "ralph.fullname" . }}-gcpsm
    kind: SecretStore
  target:
    name: ralph-github-token
    creationPolicy: Owner
  data:
    - secretKey: token
      remoteRef:
        key: ralph-github-token

---
# Anthropic API Key
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: {{ include "ralph.fullname" . }}-anthropic-key
  labels:
    {{- include "ralph.labels" . | nindent 4 }}
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: {{ include "ralph.fullname" . }}-gcpsm
    kind: SecretStore
  target:
    name: ralph-anthropic-key
    creationPolicy: Owner
  data:
    - secretKey: key
      remoteRef:
        key: ralph-anthropic-key

---
# Langfuse
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: {{ include "ralph.fullname" . }}-langfuse
  labels:
    {{- include "ralph.labels" . | nindent 4 }}
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: {{ include "ralph.fullname" . }}-gcpsm
    kind: SecretStore
  target:
    name: ralph-langfuse
    creationPolicy: Owner
  data:
    - secretKey: publicKey
      remoteRef:
        key: ralph-langfuse-public-key
    - secretKey: secretKey
      remoteRef:
        key: ralph-langfuse-secret-key
    - secretKey: host
      remoteRef:
        key: ralph-langfuse-host

---
# Linear Webhook Secret
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: {{ include "ralph.fullname" . }}-linear-secret
  labels:
    {{- include "ralph.labels" . | nindent 4 }}
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: {{ include "ralph.fullname" . }}-gcpsm
    kind: SecretStore
  target:
    name: ralph-linear-secret
    creationPolicy: Owner
  data:
    - secretKey: webhook-secret
      remoteRef:
        key: ralph-linear-webhook-secret
    - secretKey: api-key
      remoteRef:
        key: ralph-linear-api-key

---
# Redis URL
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: {{ include "ralph.fullname" . }}-redis-secret
  labels:
    {{- include "ralph.labels" . | nindent 4 }}
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: {{ include "ralph.fullname" . }}-gcpsm
    kind: SecretStore
  target:
    name: ralph-redis-secret
    creationPolicy: Owner
  data:
    - secretKey: redis-url
      remoteRef:
        key: ralph-redis-url
{{- end }}
